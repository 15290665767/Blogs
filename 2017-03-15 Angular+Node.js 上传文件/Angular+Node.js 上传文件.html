<!DOCTYPE html>
<html lang="zh-CN" ng-app="app">
<head>
<meta charset="UTF-8">
<title>node-file</title>
<link rel='stylesheet' href='/stylesheets/style.css' />
</head>
<body>

<!-- HTML -->
<form ng-controller="form" id="uploadFiles" name="uploadFiles" action="javascript:">
    <div class="form-list">
        <input type="file" name="files">
    </div>
    <div class="form-list">
        <button type="button" ng-click="formSubmit()">Submit</button>
    </div>
</form>
<!-- HTML -->

<!-- AngularJS -->
<script src="/javascripts/angular-1.5.5.min.js"></script>
<script>
var app = angular.module('app', []);

app.controller('form', ['$scope','$http', function($scope,$http){
    $scope.formSubmit = function(){

        var formData = new FormData(document.getElementById("uploadFiles"));

        var url = "/postFile",
            method = "post",
            data = formData;
        $http({ 
            url:url,
            method:method,
            headers : {'Content-Type': undefined},
            data:data,
        }) 
        .success(function(data){ 
            console.log("yes!");
        })
        .error(function(data){
            console.log("error");
        });

    };
}]);

</script>
<!-- AngularJS -->

<!-- node -->
var express = require('express');
var router = express.Router();
var fs = require('fs');
var util = require('util');
var multer  = require('multer');
var upload = multer({dest:'uploads/'});

/* GET home page. */
router.get('/', function(req, res, next) {
    res.render('index', { title: 'Express' });
});

// postFile
router.post('/postFile', upload.single('files'), function(req, res, next) {

    // 保存文件
    fs.readFile(process.cwd() + '/uploads/' + req.file.filename,function(err,data){

        if(err){
            console.log("文件读取失败："+err);
        }else{
            console.log("文件读取成功");
            // 将文件写入到指定目录
            fs.writeFile(process.cwd() + '/uploads/' + req.file.originalname,data,function(err){
                if(err){
                    console.log("写入失败："+err);
                }else{
                    console.log('写入成功');
                }
            });
            // 删除临时保存的文件
            fs.unlink(process.cwd() + '/uploads/' + req.file.filename, function(err) {
                if(err){
                    console.log("文件删除失败："+err);
                }else{
                    console.log('文件删除成功');
                }
            });

            var url = 'http://' + req.headers.host + '/' + req.file.originalname;

            // 将上传后的地址返回给前端
            res.json({code:1,url:url});
            
        }
    });

});

module.exports = router;
<!-- node -->

</body>
</html>
